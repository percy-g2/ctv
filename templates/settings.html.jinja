{% extends "base.html.jinja" %}
{% block content %}
  <h2>Settings</h2>
  
  <article>
    <header><h3>Color Scheme</h3></header>
    <form id="theme-form" method="post" action="/settings">
      <fieldset>
        <legend>Select Theme</legend>
        <label>
          <input 
            type="radio" 
            name="theme" 
            value="light" 
            {% if theme == "light" %}checked{% endif %}
            onchange="updateTheme('light')"
          />
          Light
        </label>
        <label>
          <input 
            type="radio" 
            name="theme" 
            value="dark" 
            {% if theme == "dark" %}checked{% endif %}
            onchange="updateTheme('dark')"
          />
          Dark
        </label>
      </fieldset>
    </form>
  </article>

  <script>
    function updateTheme(theme) {
      // Set cookie with 1 year expiry
      const expiryDate = new Date();
      expiryDate.setFullYear(expiryDate.getFullYear() + 1);
      document.cookie = `theme=${theme}; path=/; expires=${expiryDate.toUTCString()}`;
      
      // Update the theme immediately
      document.documentElement.setAttribute('data-theme', theme);
    }

    // Apply theme on page load
    (function() {
      const theme = getCookie('theme') || '{{ theme }}';
      document.documentElement.setAttribute('data-theme', theme);
    })();

    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
      return null;
    }
  </script>
{% endblock %}
